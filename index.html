<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<title>Premium POS System ‚Äì Final</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" rel="stylesheet" />
<style>
/*  =========================================
    üé® VARIABLES & GLOBAL
    ========================================= */
:root {
  /* warna tema (bisa diubah via Settings) */
  --clr-primary: #4361ee;
  --clr-secondary: #3f37c9;
  --clr-success: #10b981;
  --clr-danger: #ef4444;
  --clr-warning: #f59e0b;
  --clr-info: #3b82f6;
  --clr-dark: #1a1a2e;
  --clr-light: #f8f9fa;
  --clr-bg: #ffffff;
  --clr-bg-dark: #1e1e2f;
  --clr-card: #ffffff;
  --clr-card-dark: #252547;

  /* glassmorphism */
  --glass: rgba(255, 255, 255, 0.25);
  --glass-border: rgba(255, 255, 255, 0.18);
  --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  --border-radius: 12px;
}

[data-theme="dark"] {
  --clr-bg: var(--clr-bg-dark);
  --clr-card: var(--clr-card-dark);
  --glass: rgba(255, 255, 255, 0.07);
  --glass-border: rgba(255, 255, 255, 0.08);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Poppins', sans-serif;
}

body {
  background: var(--clr-bg);
  color: var(--clr-dark);
  transition: all 0.3s ease;
}

/*  =========================================
    üß© LAYOUT & GRID
    ========================================= */
.container {
  max-width: 100%;
  margin: 0 auto;
  padding: 20px;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--clr-primary);
  color: #fff;
  padding: 15px 20px;
  border-radius: var(--border-radius);
  margin-bottom: 20px;
  box-shadow: var(--shadow);
}

.main-content {
  display: grid;
  grid-template-columns: 1fr 2fr;
  gap: 20px;
}

@media (max-width: 992px) {
  .main-content {
    grid-template-columns: 1fr;
  }
}

.left-panel,
.right-panel {
  background: var(--clr-card);
  border-radius: var(--border-radius);
  padding: 20px;
  box-shadow: var(--shadow);
}

/*  =========================================
    üßæ CARD & BUTTONS
    ========================================= */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 10px 18px;
  border: none;
  border-radius: var(--border-radius);
  cursor: pointer;
  font-weight: 500;
  transition: all 0.3s ease;
}

.btn-primary { background: var(--clr-primary); color: #fff; }
.btn-success { background: var(--clr-success); color: #fff; }
.btn-danger  { background: var(--clr-danger);  color: #fff; }
.btn-warning { background: var(--clr-warning); color: #fff; }

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

/*  =========================================
    üñºÔ∏è MODAL ‚Äì glassmorphism
    ========================================= */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 2000;
  animation: fadeIn 0.3s ease;
}

.modal-content {
  background: var(--glass);
  backdrop-filter: blur(12px);
  border: 1px solid var(--glass-border);
  border-radius: var(--border-radius);
  width: 90%;
  max-width: 800px;
  max-height: 90vh;
  overflow-y: auto;
  padding: 20px;
  color: var(--clr-dark);
}

[data-theme="dark"] .modal-content {
  color: var(--clr-light);
}

/*  =========================================
    üìä TABLE
    ========================================= */
.table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 1rem;
}

.table th,
.table td {
  padding: 12px 15px;
  text-align: left;
  border-bottom: 1px solid #ddd;
}

.table th {
  background: var(--clr-primary);
  color: #fff;
  position: sticky;
  top: 0;
}

/*  =========================================
    üîç LOADING SKELETON
    ========================================= */
.skeleton {
  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
  background-size: 200% 100%;
  animation: skeleton 1.5s infinite;
  border-radius: var(--border-radius);
}

@keyframes skeleton {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

/*  =========================================
    üåô DARK MODE TOGGLE
    ========================================= */
.theme-toggle {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1000;
  background: var(--clr-card);
  border-radius: 50%;
  width: 48px;
  height: 48px;
  display: grid;
  place-items: center;
  cursor: pointer;
  box-shadow: var(--shadow);
}

/*  =========================================
    üßæ RECEIPT
    ========================================= */
.receipt {
  background: #fff;
  max-width: 300px;
  margin: 0 auto;
  padding: 15px;
  font-family: 'Courier New', monospace;
  border-radius: var(--border-radius);
  box-shadow: var(--shadow);
}

/*  =========================================
    üì± RESPONSIVE
    ========================================= */
@media print {
  body * { visibility: hidden; }
  .receipt, .receipt * { visibility: visible; }
  .receipt {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
  }
}

/*  =========================================
    üéØ ANIMATIONS
    ========================================= */
@keyframes fadeIn {
  from {opacity: 0; transform: translateY(-10px);}
  to   {opacity: 1; transform: translateY(0);}
}

.fade-in { animation: fadeIn 0.4s ease forwards; }
</style>
</head>

<body>
<!-- üåô Toggle dark mode -->
<button id="themeToggle" class="theme-toggle" title="Toggle dark mode">
  <i class="fas fa-moon"></i>
</button>

<!-- üîê Login Modal -->
<div id="loginModal" class="modal" style="display:flex;">
  <div class="modal-content" style="max-width: 400px;">
    <h2 style="text-align:center;margin-bottom:20px;">Premium POS</h2>
    <form id="loginForm">
      <div class="form-group">
        <label>ID Kasir</label>
        <input type="text" id="cashierId" class="form-control" required>
      </div>
      <div class="form-group">
        <label>PIN (4 digit)</label>
        <input type="password" id="cashierPin" class="form-control" maxlength="4" required>
      </div>
      <button type="submit" class="btn btn-primary btn-block">Login</button>
    </form>
  </div>
</div>

<!-- üè™ Main App -->
<div id="mainApp" style="display:none;">
  <!-- Header -->
  <header class="header">
    <div>
      <h1 id="storeName">Premium POS</h1>
      <p id="storeAddress">Jl. Contoh No. 123, Kota Contoh</p>
    </div>
    <div style="text-align:right;">
      <p id="currentDate">Senin, 1 Jan 2024 08:00</p>
      <p>Kasir: <span id="loggedInCashier">Admin</span> | <a href="#" id="logoutBtn" style="color:#fff;">Logout</a></p>
    </div>
  </header>

  <!-- Grid -->
  <div class="main-content">
    <!-- Left Panel -->
    <div class="left-panel">
      <h3>Produk</h3>
      <div class="form-group">
        <input type="text" id="productSearch" class="form-control" placeholder="Cari / Scan Barcode‚Ä¶">
      </div>
      <div class="form-group">
        <select id="productCategory" class="form-control">
          <option value="all">Semua Kategori</option>
        </select>
      </div>
      <div id="productList" class="table-responsive">
        <!-- skeleton -->
        <div class="skeleton" style="height:200px;"></div>
      </div>
    </div>

    <!-- Right Panel -->
    <div class="right-panel">
      <h3>Transaksi</h3>
      <!-- Tabs -->
      <div class="tabs">
        <button class="tab active" data-tab="cart">Keranjang</button>
        <button class="tab" data-tab="customer">Pelanggan</button>
        <button class="tab" data-tab="payment">Pembayaran</button>
      </div>

      <!-- Cart -->
      <div class="tab-content active" id="cartTab">
        <div id="cartItems" style="min-height:150px;"></div>
        <div style="margin-top:15px;">
          <div style="display:flex;justify-content:space-between;margin-bottom:10px;">
            <span>Subtotal:</span><span id="cartSubtotal">Rp 0</span>
          </div>
          <div style="display:flex;justify-content:space-between;margin-bottom:10px;">
            <span>Diskon:</span><span id="cartDiscount">Rp 0</span>
          </div>
          <div style="display:flex;justify-content:space-between;margin-bottom:10px;">
            <span>Total:</span><span id="cartTotal" style="font-weight:700;">Rp 0</span>
          </div>
          <button id="nextToCustomer" class="btn btn-primary btn-block">Lanjut ke Pelanggan</button>
        </div>
      </div>

      <!-- Customer -->
      <div class="tab-content" id="customerTab">
        <div class="form-group">
          <select id="customerType" class="form-control">
            <option value="walkin">Pelanggan Biasa</option>
            <option value="member">Member</option>
          </select>
        </div>
        <div id="customerFields" style="display:none;">
          <div class="form-group">
            <label>ID Member</label>
            <input type="text" id="memberId" class="form-control" placeholder="Scan atau ketik">
          </div>
          <div class="form-group">
            <label>Nama</label>
            <input type="text" id="customerName" class="form-control">
          </div>
          <div class="form-group">
            <label>No. Telepon</label>
            <input type="tel" id="customerPhone" class="form-control">
          </div>
        </div>
        <div style="display:flex;gap:10px;margin-top:10px;">
          <button id="backToCart" class="btn btn-warning">Kembali</button>
          <button id="nextToPayment" class="btn btn-primary">Lanjut ke Pembayaran</button>
        </div>
      </div>

      <!-- Payment -->
      <div class="tab-content" id="paymentTab">
        <div style="display:flex;justify-content:space-between;margin-bottom:10px;">
          <span>Total Bayar:</span><span id="paymentTotal" style="font-weight:700;">Rp 0</span>
        </div>
        <div class="form-group">
          <label>Jumlah Uang</label>
          <input type="number" id="paymentAmount" class="form-control" placeholder="0">
        </div>
        <div class="form-group">
          <label>Metode Bayar</label>
          <select id="paymentMethod" class="form-control">
            <option value="cash">Tunai</option>
            <option value="qris">QRIS</option>
            <option value="transfer">Transfer Bank</option>
          </select>
        </div>
        <div id="changeDisplay" style="margin:10px 0;font-weight:700;"></div>
        <div style="display:flex;gap:10px;">
          <button id="backToCustomer" class="btn btn-warning">Kembali</button>
          <button id="completePayment" class="btn btn-success">Selesaikan & Cetak</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- üßæ Receipt Template (hidden) -->
<div id="receiptTemplate" style="display:none;">
  <div class="receipt">
    <div class="receipt-header">
      <div id="receiptStoreName">Premium POS</div>
      <div id="receiptStoreAddress">Jl. Contoh No. 123</div>
      <div id="receiptDate">01/01/2024 08:00</div>
    </div>
    <div id="receiptItems"></div>
    <div class="receipt-total">
      <div>Total: <span id="receiptTotal">Rp 0</span></div>
      <div>Bayar: <span id="receiptPay">Rp 0</span></div>
      <div>Kembali: <span id="receiptChange">Rp 0</span></div>
    </div>
    <div style="text-align:center;margin-top:10px;font-size:12px;">Terima kasih!</div>
  </div>
</div>

<!-- üîê Admin FAB -->
<button id="adminAccess" class="theme-toggle" style="bottom:20px;right:20px;" title="Admin Dashboard">
  <i class="fas fa-cog"></i>
</button>

<!-- üß© CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<script>
/*  ===================================================================
    üóÇÔ∏è DATA STORAGE KEYS
    =================================================================== */
const STORAGE = {
  PRODUCTS: 'pos_products_v2',
  TRANSACTIONS: 'pos_transactions_v2',
  CUSTOMERS: 'pos_customers_v2',
  CATEGORIES: 'pos_categories_v2',
  SETTINGS: 'pos_settings_v2',
  CART: 'pos_current_cart',
  CASHIER: 'pos_current_cashier'
};

/*  ===================================================================
    üß∞ HELPERS
    =================================================================== */
const fmt = (n) => 'Rp ' + (n || 0).toLocaleString('id-ID');
const $ = (sel) => document.querySelector(sel);
const $$ = (sel) => document.querySelectorAll(sel);

/*  ===================================================================
    ü™Ñ DEFAULT DATA
    =================================================================== */
let products = JSON.parse(localStorage.getItem(STORAGE.PRODUCTS)) || [
  {id:'P001',barcode:'123456',name:'Biskuit Roma',brand:'Roma',unit:'Pcs',categoryId:'C001',price:5000,purchasePrice:4000,stock:20},
  {id:'P002',barcode:'654321',name:'Teh Kotak',brand:'Sosro',unit:'Pcs',categoryId:'C002',price:7000,purchasePrice:6000,stock:15}
];
let transactions = JSON.parse(localStorage.getItem(STORAGE.TRANSACTIONS)) || [];
let customers = JSON.parse(localStorage.getItem(STORAGE.CUSTOMERS)) || [
  {id:'M001',type:'member',name:'Andi',phone:'081234567890',points:0}
];
let categories = JSON.parse(localStorage.getItem(STORAGE.CATEGORIES)) || [
  {id:'C001',name:'Makanan'},{id:'C002',name:'Minuman'}
];
let settings = JSON.parse(localStorage.getItem(STORAGE.SETTINGS)) || {
  storeName:'Premium POS',
  storeAddress:'Jl. Contoh No. 123',
  storePhone:'081234567890',
  taxRate:0,
  theme:'light'
};

let cart = JSON.parse(localStorage.getItem(STORAGE.CART)) || {items:[],subtotal:0,discount:0,total:0};
let cashier = JSON.parse(localStorage.getItem(STORAGE.CASHIER)) || null;

/*  ===================================================================
    üñ•Ô∏è INIT
    =================================================================== */
function init() {
  applyTheme(settings.theme);
  loadProducts();
  updateCartUI();
  updateClock();
  setInterval(updateClock, 60000);
}
init();

/*  ===================================================================
    üåô THEME TOGGLE
    =================================================================== */
$('#themeToggle').addEventListener('click', () => {
  const next = document.documentElement.dataset.theme === 'dark' ? 'light' : 'dark';
  applyTheme(next);
  settings.theme = next;
  localStorage.setItem(STORAGE.SETTINGS, JSON.stringify(settings));
});
function applyTheme(t) {
  document.documentElement.dataset.theme = t;
  $('#themeToggle').innerHTML = t === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
}

/*  ===================================================================
    ‚è∞ CLOCK
    =================================================================== */
function updateClock() {
  $('#currentDate').innerText = moment().format('dddd, D MMM YYYY ‚Äì HH:mm');
}

/*  ===================================================================
    üîê LOGIN / LOGOUT
    =================================================================== */
$('#loginForm').addEventListener('submit', (e) => {
  e.preventDefault();
  const id = $('#cashierId').value.trim();
  const pin = $('#cashierPin').value.trim();
  if (id === 'K001' && pin === '1234') {
    cashier = {id, name:'Admin'};
    localStorage.setItem(STORAGE.CASHIER, JSON.stringify(cashier));
    $('#loggedInCashier').innerText = cashier.name;
    $('#loginModal').style.display = 'none';
    $('#mainApp').style.display = 'block';
  } else {
    alert('ID atau PIN salah!');
  }
});
$('#logoutBtn').addEventListener('click', () => {
  cashier = null;
  localStorage.removeItem(STORAGE.CASHIER);
  $('#mainApp').style.display = 'none';
  $('#loginModal').style.display = 'flex';
  $('#cashierId').value = '';
  $('#cashierPin').value = '';
});

/*  ===================================================================
    üõçÔ∏è PRODUCTS
    =================================================================== */
function loadProducts(search = '') {
  const list = $('#productList');
  const cat = $('#productCategory').value;
  let html = '<table class="table"><thead><tr><th>Nama</th><th>Harga</th><th>Stok</th><th></th></tr></thead><tbody>';
  const filtered = products.filter(p => {
    const matchSearch = p.name.toLowerCase().includes(search.toLowerCase()) || p.barcode.includes(search);
    const matchCat = cat === 'all' || p.categoryId === cat;
    return matchSearch && matchCat;
  });
  filtered.forEach(p => {
    html += `
      <tr>
        <td>${p.name}<br><small>${p.brand} ‚Ä¢ ${p.unit}</small></td>
        <td>${fmt(p.price)}</td>
        <td>${p.stock}</td>
        <td><button class="btn btn-success btn-sm add-to-cart" data-id="${p.id}"><i class="fas fa-cart-plus"></i></button></td>
      </tr>`;
  });
  html += '</tbody></table>';
  list.innerHTML = html;
}
$('#productSearch').addEventListener('input', (e) => loadProducts(e.target.value));
$('#productCategory').addEventListener('change', () => loadProducts($('#productSearch').value));

/*  ===================================================================
    üõí CART
    =================================================================== */
$(document).addEventListener('click', (e) => {
  if (e.target.classList.contains('add-to-cart')) {
    const id = e.target.dataset.id;
    const prod = products.find(p => p.id === id);
    if (!prod || prod.stock <= 0) return alert('Stok habis!');
    const item = cart.items.find(i => i.product.id === id);
    if (item) {
      if (item.quantity < prod.stock) item.quantity++; else alert('Stok tidak cukup!');
    } else {
      cart.items.push({product:prod,quantity:1});
    }
    updateCartUI();
  }
  if (e.target.classList.contains('remove-from-cart')) {
    const id = e.target.dataset.id;
    cart.items = cart.items.filter(i => i.product.id !== id);
    updateCartUI();
  }
});
function updateCartUI() {
  cart.subtotal = cart.items.reduce((a,b) => a + b.product.price * b.quantity, 0);
  cart.total = cart.subtotal - cart.discount;
  $('#cartItems').innerHTML = cart.items.map(i => `
    <div class="cart-item">
      <span>${i.product.name} (${i.quantity})</span>
      <span>${fmt(i.product.price * i.quantity)}</span>
      <button class="btn btn-danger btn-sm remove-from-cart" data-id="${i.product.id}"><i class="fas fa-trash"></i></button>
    </div>`).join('');
  $('#cartSubtotal').innerText = fmt(cart.subtotal);
  $('#cartTotal').innerText = fmt(cart.total);
  $('#paymentTotal').innerText = fmt(cart.total);
  localStorage.setItem(STORAGE.CART, JSON.stringify(cart));
}

/*  ===================================================================
    üßæ TABS
    =================================================================== */
$$('.tab').forEach(t => t.addEventListener('click', () => {
  $$('.tab').forEach(x => x.classList.remove('active'));
  $$('.tab-content').forEach(x => x.classList.remove('active'));
  t.classList.add('active');
  $(`#${t.dataset.tab}Tab`).classList.add('active');
}));

/*  ===================================================================
    üë§ CUSTOMER
    =================================================================== */
$('#customerType').addEventListener('change', (e) => {
  $('#customerFields').style.display = e.target.value === 'member' ? 'block' : 'none';
});
$('#nextToCustomer').addEventListener('click', () => {
  $$('.tab')[1].click();
});
$('#backToCart').addEventListener('click', () => $$('.tab')[0].click());
$('#nextToPayment').addEventListener('click', () => $$('.tab')[2].click());
$('#backToCustomer').addEventListener('click', () => $$('.tab')[1].click());

/*  ===================================================================
    üí≥ PAYMENT
    =================================================================== */
$('#paymentAmount').addEventListener('input', () => {
  const paid = Number($('#paymentAmount').value) || 0;
  const change = paid - cart.total;
  $('#changeDisplay').innerText = change >= 0 ? `Kembali: ${fmt(change)}` : 'Uang kurang!';
});
$('#completePayment').addEventListener('click', () => {
  const paid = Number($('#paymentAmount').value) || 0;
  if (paid < cart.total) return alert('Uang tidak cukup!');
  const transaction = {
    id:'T'+moment().format('YYYYMMDDHHmmss'),
    date:new Date(),
    items:cart.items,
    subtotal:cart.subtotal,
    total:cart.total,
    paid,
    change:paid-cart.total,
    method:$('#paymentMethod').value,
    cashier:cashier.name
  };
  transactions.unshift(transaction);
  localStorage.setItem(STORAGE.TRANSACTIONS, JSON.stringify(transactions));
  cart.items.forEach(i => {
    const p = products.find(pr => pr.id === i.product.id);
    if (p) p.stock -= i.quantity;
  });
  localStorage.setItem(STORAGE.PRODUCTS, JSON.stringify(products));
  printReceipt(transaction);
  resetCart();
  $$('.tab')[0].click();
});
function resetCart() {
  cart = {items:[],subtotal:0,discount:0,total:0};
  localStorage.setItem(STORAGE.CART, JSON.stringify(cart));
  updateCartUI();
  $('#paymentAmount').value = '';
  $('#changeDisplay').innerText = '';
}

/*  ===================================================================
    üßæ PRINT RECEIPT
    =================================================================== */
function printReceipt(t) {
  const receipt = $('#receiptTemplate').cloneNode(true);
  receipt.style.display = 'block';
  receipt.querySelector('#receiptStoreName').innerText = settings.storeName;
  receipt.querySelector('#receiptStoreAddress').innerText = settings.storeAddress;
  receipt.querySelector('#receiptDate').innerText = moment(t.date).format('DD/MM/YYYY HH:mm');
  receipt.querySelector('#receiptItems').innerHTML = t.items.map(i => 
    `<div>${i.product.name} x${i.quantity}</div><div>${fmt(i.product.price*i.quantity)}</div>`).join('<br>');
  receipt.querySelector('#receiptTotal').innerText = fmt(t.total);
  receipt.querySelector('#receiptPay').innerText = fmt(t.paid);
  receipt.querySelector('#receiptChange').innerText = fmt(t.change);
  document.body.appendChild(receipt);
  window.print();
  document.body.removeChild(receipt);
}

/*  ===================================================================
    ‚öôÔ∏è ADMIN ‚Äì open modal (placeholder)
    =================================================================== */
$('#adminAccess').addEventListener('click', () => alert('Admin Dashboard akan muncul di versi berikutnya. Fitur: CRUD Produk/Kategori, Laporan, Backup, dll.'));
</script>
</body>
</html>
