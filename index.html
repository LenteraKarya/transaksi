<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium POS System – FINAL FULL</title>

    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <!-- 3rd-party CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-daterangepicker/3.0.5/daterangepicker.min.css">
    <style>
        /* ===== ROOT / DARK MODE VARIABLES ===== */
        :root{
            --primary-color:#4361ee;
            --secondary-color:#3f37c9;
            --accent-color:#4895ef;
            --dark-color:#1a1a2e;
            --light-color:#f8f9fa;
            --success-color:#10b981;
            --danger-color:#ef4444;
            --warning-color:#f59e0b;
            --info-color:#3b82f6;
            --gray-color:#6b7280;
            --bg-body:#f5f7fa;
            --bg-card:#ffffff;
            --border-color:#e5e7eb;
            --shadow:0 4px 6px -1px rgba(0,0,0,.1);
            --rounded:.5rem;
        }
        body.dark{
            --bg-body:#111827;
            --bg-card:#1f2937;
            --dark-color:#f1f1f1;
            --border-color:#374151;
            color-scheme:dark;
        }

        *{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
        body{background:var(--bg-body);color:var(--dark-color);line-height:1.6;}
        .container{max-width:100%;margin:0 auto;padding:20px;}
        .header{background:linear-gradient(135deg,var(--primary-color),var(--secondary-color));color:white;padding:15px 20px;border-radius:var(--rounded);margin-bottom:20px;display:flex;justify-content:space-between;align-items:center;}
        .header h1{font-size:1.8rem;font-weight:600;}
        .main-content{display:flex;gap:20px;flex-wrap:wrap;}
        .left-panel,.right-panel{flex:1 1 300px;background:var(--bg-card);padding:20px;border-radius:var(--rounded);box-shadow:var(--shadow);}
        .panel-title{font-size:1.2rem;margin-bottom:15px;border-bottom:2px solid var(--primary-color);padding-bottom:5px;font-weight:600;}
        .table{width:100%;border-collapse:collapse;margin-bottom:20px;}
        .table th,.table td{padding:12px 15px;text-align:left;border-bottom:1px solid var(--border-color);}
        .table th{background:var(--light-color);}
        .btn{display:inline-block;padding:10px 20px;border:none;border-radius:var(--rounded);cursor:pointer;font-size:1rem;transition:.3s;}
        .btn-success{background:var(--success-color);color:white;}
        .btn-danger{background:var(--danger-color);color:white;}
        .btn-warning{background:var(--warning-color);color:white;}
        .btn-info{background:var(--info-color);color:white;}
        .modal{display:none;position:fixed;inset:0;z-index:1000;background:rgba(0,0,0,.5);align-items:center;justify-content:center;}
        .modal-content{background:var(--bg-card);padding:20px;border-radius:var(--rounded);max-width:90vw;max-height:90vh;overflow:auto;}
        .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;}
        .modal-close{background:none;border:none;font-size:1.5rem;cursor:pointer;color:var(--gray-color);}
        .tabs{display:flex;border-bottom:1px solid var(--border-color);margin-bottom:20px;}
        .tab{padding:10px 20px;cursor:pointer;border-bottom:2px solid transparent;}
        .tab.active{border-bottom:2px solid var(--primary-color);color:var(--primary-color);font-weight:500;}
        .tab-content{display:none;}
        .tab-content.active{display:block;animation:fadeIn .3s;}
        @keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
        .toast{position:fixed;top:20px;right:20px;padding:12px 18px;background:#333;color:white;border-radius:var(--rounded);z-index:1100;display:flex;align-items:center;transform:translateX(200%);transition:.3s;}
        .toast.show{transform:translateX(0);}
        #darkModeToggle{position:fixed;top:20px;right:20px;z-index:999;background:var(--primary-color);color:white;border-radius:50%;padding:10px;cursor:pointer;font-size:1.2rem;}
        @media print{body *{visibility:hidden;}.receipt,.receipt *{visibility:visible;}.receipt{position:absolute;left:0;top:0;width:100%;box-shadow:none;padding:20px;font-size:14px;}}
    </style>
</head>

<body>
    <!-- Dark-mode toggle -->
    <button id="darkModeToggle" title="Mode Gelap"><i class="fas fa-moon"></i></button>

    <!-- Toast -->
    <div id="toast"><i class="fas fa-info-circle"></i><span id="toast-message"></span></div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content" style="max-width:400px">
            <div class="modal-header"><h3>Login Kasir</h3><button class="modal-close">&times;</button></div>
            <form id="loginForm">
                <label>ID Kasir</label><input type="text" id="cashierId" required class="form-control">
                <label>PIN (4 digit)</label><input type="password" id="cashierPin" maxlength="4" required class="form-control">
                <button type="submit" class="btn btn-success btn-block">Login</button>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div class="container" id="mainApp" style="display:none;">
        <div class="header">
            <div>
                <h1 id="storeName">Premium POS System</h1>
                <p id="storeAddress">Jl. Contoh No. 123, Kota Contoh</p>
            </div>
            <div>
                <p id="currentDate">-</p>
                <p>Kasir: <span id="loggedInCashier">-</span> | <a href="#" id="logoutBtn" style="color:white;text-decoration:none;">Logout</a></p>
            </div>
        </div>

        <div class="main-content">
            <!-- LEFT PANEL -->
            <div class="left-panel">
                <h2 class="panel-title">Produk</h2>
                <input type="text" id="productSearch" placeholder="Cari produk..." class="form-control">
                <select id="productCategory" class="form-control">
                    <option value="all">Semua Kategori</option>
                </select>
                <div class="table-responsive">
                    <table class="table">
                        <thead><tr><th>Nama</th><th>Harga</th><th>Stok</th><th>Aksi</th></tr></thead>
                        <tbody id="productListBody"></tbody>
                    </table>
                </div>
            </div>

            <!-- RIGHT PANEL -->
            <div class="right-panel">
                <h2 class="panel-title">Transaksi</h2>
                <div class="tabs">
                    <div class="tab active" data-tab="cart">Keranjang</div>
                    <div class="tab" data-tab="customer">Pelanggan</div>
                    <div class="tab" data-tab="payment">Pembayaran</div>
                </div>

                <!-- Cart -->
                <div class="tab-content active" id="cartTab">
                    <div id="cartItems"></div>
                    <div class="cart-summary">
                        <div style="display:flex;justify-content:space-between"><span>Subtotal:</span><span id="cartSubtotal">Rp 0</span></div>
                        <div style="display:flex;justify-content:space-between"><span>Diskon:</span><span id="cartDiscount">Rp 0</span></div>
                        <div style="display:flex;justify-content:space-between"><span>Pajak:</span><span id="cartTax">Rp 0</span></div>
                        <div style="display:flex;justify-content:space-between;font-weight:700"><span>Total:</span><span id="cartTotal">Rp 0</span></div>
                    </div>
                    <button id="nextToCustomer" class="btn btn-success btn-block">Lanjut ke Pelanggan</button>
                </div>

                <!-- Customer -->
                <div class="tab-content" id="customerTab">
                    <select id="customerType" class="form-control">
                        <option value="walkin">Pelanggan Biasa</option>
                        <option value="member">Member</option>
                    </select>
                    <div id="memberFields" style="display:none;margin-top:10px">
                        <input type="text" id="memberId" placeholder="ID Member" class="form-control">
                        <input type="number" id="memberDiscount" placeholder="Diskon (%)" value="10" class="form-control">
                    </div>
                    <div style="margin-top:10px">
                        <button id="backToCart" class="btn btn-warning">Kembali</button>
                        <button id="nextToPayment" class="btn btn-success float-right">Lanjut ke Pembayaran</button>
                    </div>
                </div>

                <!-- Payment -->
                <div class="tab-content" id="paymentTab">
                    <div class="cart-summary">
                        <div style="display:flex;justify-content:space-between;font-weight:700"><span>Total:</span><span id="paymentTotal">Rp 0</span></div>
                        <input type="number" id="paymentAmount" placeholder="Jumlah Bayar" class="form-control">
                        <div style="margin:10px 0">
                            <label><input type="radio" name="paymentMethod" value="cash" checked> Tunai</label><br>
                            <label><input type="radio" name="paymentMethod" value="transfer"> Transfer</label><br>
                            <label><input type="radio" name="paymentMethod" value="ewallet"> E-Wallet</label>
                        </div>
                        <button id="completePayment" class="btn btn-success btn-block"><i class="fas fa-print"></i> Selesaikan & Cetak</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin access button -->
    <button id="adminAccess" class="btn" style="position:fixed;bottom:20px;right:20px;z-index:99"><i class="fas fa-lock"></i></button>

    <script>
        const ADMIN_PASSWORD='Geraiku.12345';
        // LocalStorage keys
        const STORAGE={
            products:'pos_products',
            categories:'pos_categories',
            customers:'pos_customers',
            cashiers:'pos_cashiers',
            transactions:'pos_transactions',
            settings:'pos_settings',
            cart:'pos_current_cart',
            cashier:'pos_current_cashier',
            darkMode:'pos_dark_mode'
        };
        // utility
        const $=s=>document.querySelector(s);
        const $$=s=>document.querySelectorAll(s);
        const ls=localStorage;
        const save=(k,v)=>ls.setItem(k,JSON.stringify(v));
        const load=(k,d=[])=>JSON.parse(ls.getItem(k)||'null')||d;
        const fmt=n=>'Rp '+n.toLocaleString('id-ID');
        const toast=(m,t='info')=>{const el=$('#toast');el.querySelector('span').textContent=m;el.className='toast '+t+' show';setTimeout(()=>el.className='toast',3000);};

        // initial data
        let products=load(STORAGE.products,[
            {id:'P001',barcode:'123456789',name:'Susu UHT',brand:'Dancow',unit:'Pcs',categoryId:'C001',price:6000,stock:10,minStock:5},
            {id:'P002',barcode:'987654321',name:'Biskuit Roma',brand:'Roma',unit:'Box',categoryId:'C002',price:12000,stock:8,minStock:5}
        ]);
        let categories=load(STORAGE.categories,[{id:'C001',name:'Minuman'},{id:'C002',name:'Snack'}]);
        let customers=load(STORAGE.customers,[]);
        let cashiers=load(STORAGE.cashiers,[{id:'K001',name:'Admin',pin:'1234',status:'active'}]);
        let transactions=load(STORAGE.transactions,[]);
        let settings=load(STORAGE.settings,{storeName:'Premium POS System',storeAddress:'Jl. Contoh No. 123',storePhone:'081234567890',taxRate:10,holidayDiscount:0});
        let cart=load(STORAGE.cart,{items:[],customer:null,discount:0,tax:0,subtotal:0,total:0});
        let currentCashier=load(STORAGE.cashier);

        // dark mode
        const toggleDark=()=>{document.body.classList.toggle('dark');ls.setItem(STORAGE.darkMode,document.body.classList.contains('dark'));};
        $('#darkModeToggle').addEventListener('click',toggleDark);
        if(ls.getItem(STORAGE.darkMode)==='true')document.body.classList.add('dark');

        // login / logout
        $('#loginForm').addEventListener('submit',e=>{
            e.preventDefault();
            const id=$('#cashierId').value.trim(),pin=$('#cashierPin').value.trim();
            const user=cashiers.find(c=>c.id===id&&c.pin===pin&&c.status==='active');
            if(user){currentCashier=user;save(STORAGE.cashier,user);$('#loginModal').style.display='none';$('#mainApp').style.display='block';loadProducts();updateCart();toast('Login berhasil');}else{toast('ID/PIN salah','error');}
        });
        $('#logoutBtn').addEventListener('click',()=>{currentCashier=null;ls.removeItem(STORAGE.cashier);$('#mainApp').style.display='none';$('#loginModal').style.display='flex';});

        // products
        function loadProducts(search='',category='all'){
            let list=products;
            if(search)list=list.filter(p=>p.name.toLowerCase().includes(search.toLowerCase())||p.barcode.includes(search));
            if(category!=='all')list=list.filter(p=>p.categoryId===category);
            $('#productListBody').innerHTML=list.map(p=>`
                <tr>
                    <td>${p.name}<br><small>${p.brand} • ${p.unit}</small></td>
                    <td>${fmt(p.price)}</td>
                    <td style="color:${p.stock<=p.minStock?'red':'green'}">${p.stock}</td>
                    <td><button class="btn btn-success btn-sm add-to-cart" data-id="${p.id}" ${p.stock<=0?'disabled':''}>Tambah</button></td>
                </tr>
            `).join('');
        }
        function updateCart(){
            cart.subtotal=cart.items.reduce((s,i)=>s+i.product.price*i.quantity,0);
            cart.discount=(cart.subtotal*(settings.holidayDiscount||0)/100)+(cart.customer?.discount||0);
            cart.tax=(cart.subtotal-cart.discount)*(settings.taxRate/100);
            cart.total=cart.subtotal-cart.discount+cart.tax;
            save(STORAGE.cart,cart);
            $('#cartItems').innerHTML=cart.items.length===0?'<div style="text-align:center;padding:20px;"><i class="fas fa-shopping-cart fa-2x"></i><p>Keranjang kosong</p></div>':
                cart.items.map(i=>`
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                        <div>
                            <div>${i.product.name}</div>
                            <small>${fmt(i.product.price)} x ${i.quantity}</small>
                        </div>
                        <div>
                            <input type="number" min="1" max="${i.product.stock}" value="${i.quantity}" class="qty" data-id="${i.product.id}" style="width:50px">
                            <button class="btn btn-danger btn-sm remove-from-cart" data-id="${i.product.id}"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                `).join('');
            ['cartSubtotal','cartDiscount','cartTax','cartTotal','paymentTotal'].forEach(id=>$('#'+id).textContent=fmt(cart[id.replace('cart','').toLowerCase()]||cart.total));
        }
        function resetCart(){cart={items:[],customer:null,discount:0,tax:0,subtotal:0,total:0};$('#customerType').value='walkin';$('#memberFields').style.display='none';$('#memberId, #memberDiscount, #paymentAmount').value='';updateCart();}

        // tab switching
        $$('.tab').forEach(t=>t.addEventListener('click',()=>{$$('.tab').forEach(x=>x.classList.remove('active'));t.classList.add('active');$$('.tab-content').forEach(x=>x.classList.remove('active'));$('#'+t.dataset.tab+'Tab').classList.add('active');}));
        $('#customerType').addEventListener('change',()=>$('#memberFields').style.display=$('#customerType').value==='member'?'block':'none');
        $('#nextToCustomer').addEventListener('click',()=>{$$('.tab')[1].click();});
        $('#nextToPayment').addEventListener('click',()=>{$$('.tab')[2].click();});
        $('#backToCart, #backToCustomer').forEach((btn,i)=>btn.addEventListener('click',()=>{$$('.tab')[i].click();}));

        // payment
        $('#completePayment').addEventListener('click',()=>{
            const pay=parseFloat($('#paymentAmount').value)||0;
            if(pay<cart.total){toast('Uang kurang','error');return;}
            transactions.unshift({...cart,id:'T'+moment().format('YYYYMMDDHHmmss'),date:new Date(),cashier:currentCashier,paymentAmount:pay,change:pay-cart.total,paymentMethod:$('input[name="paymentMethod"]:checked').value});
            cart.items.forEach(i=>{const p=products.find(pr=>pr.id===i.product.id);if(p)p.stock-=i.quantity;});
            save(STORAGE.transactions,transactions);save(STORAGE.products,products);
            const receipt=`
                <div class="receipt">
                    <div style="text-align:center">
                        <h3>${settings.storeName}</h3><p>${settings.storeAddress}<br>${settings.storePhone}</p>
                        <p>${moment().format('DD/MM/YYYY HH:mm:ss')}</p>
                    </div>
                    ${cart.items.map(i=>`<div style="display:flex;justify-content:space-between">${i.product.name} x${i.quantity}<span>${fmt(i.product.price*i.quantity)}</span></div>`).join('')}
                    <hr>
                    <div style="display:flex;justify-content:space-between"><span>Total</span><span>${fmt(cart.total)}</span></div>
                    <div style="display:flex;justify-content:space-between"><span>Bayar</span><span>${fmt(pay)}</span></div>
                    <div style="display:flex;justify-content:space-between"><span>Kembali</span><span>${fmt(pay-cart.total)}</span></div>
                    <div style="text-align:center;margin-top:10px">Terima kasih<br>Kasir: ${currentCashier.name}</div>
                </div>
            `;
            const w=window.open('','_blank');w.document.write(receipt);w.print();w.close();
            resetCart();toast('Transaksi selesai');
        });

        // events
        document.addEventListener('input',e=>{
            if(e.target.classList.contains('qty')){const id=e.target.dataset.id;const item=cart.items.find(i=>i.product.id===id);if(item)item.quantity=parseInt(e.target.value)||1;updateCart();}
        });
        document.addEventListener('click',e=>{
            if(e.target.classList.contains('add-to-cart')){
                const id=e.target.dataset.id;const prod=products.find(p=>p.id===id);
                const exist=cart.items.find(i=>i.product.id===id);
                if(exist){if(exist.quantity<prod.stock)exist.quantity++;}else cart.items.push({product:prod,quantity:1});
                updateCart();toast(`${prod.name} ditambahkan`);
            }
            if(e.target.classList.contains('remove-from-cart')){
                const id=e.target.dataset.id;cart.items=cart.items.filter(i=>i.product.id!==id);updateCart();
            }
            if(e.target.classList.contains('modal-close'))e.target.closest('.modal').style.display='none';
        });

        // init
        $('#productCategory').innerHTML='<option value="all">Semua Kategori</option>'+categories.map(c=>`<option value="${c.id}">${c.name}</option>`).join('');
        loadProducts();updateCart();
        $('#currentDate').textContent=moment().format('dddd, D MMMM YYYY, HH:mm');setInterval(()=>$('#currentDate').textContent=moment().format('dddd, D MMMM YYYY, HH:mm'),60000);
        currentCashier?($('#mainApp').style.display='block',$('#loggedInCashier').textContent=currentCashier.name):($('#loginModal').style.display='flex');
    </script>
</body>
</html>
